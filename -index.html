
<html>

<script src="https://code.jquery.com/jquery-1.11.2.js"></script>
<script src="/js/rxjs-2.3.23/rx.all.js"></script>
<script>
if (!('webkitSpeechRecognition' in window)) {
  alert('hallo, je hebt geen webkitSpeechRecognition beschikbaar. upgrade je browser ');
}


var recognition = new webkitSpeechRecognition();
recognition.lang = "nl-NL";
recognition.continuous = true;
recognition.interimResults = true;

var source = Rx.Observable.fromEvent(recognition, "result");
source.map(function(event){
	console.log("got something?");
	var totalTranscripts = event.results.length;
	var transcript = event.results[totalTranscripts-1][0].transcript;
	return transcript;
})
.filter(function(transcript){
	// are we intersted in this?
	return transcript.indexOf("weer in") > -1
})
.map(function(transcript){
	//exract city
	return transcript.substring(7 + transcript.indexOf("weer in")).trim();
})
.distinctUntilChanged()//dont care about sequential amsterdams
.throttleFirst(4000) // milliseconds
.flatMap(getWeatherData) //get weather data
.subscribe(
	function(weather){
		//go and do the light stuff
		console.log("weather:",weather);
	},
	function(error){
		console.error(error);
	});



recognition.onstart = function(){
	console.log("starting to listen...");
};

recognition.onerror = function(event){
	console.error("something error happen", event);
};

recognition.onend = function(){
	console.log('NANANA IM NOT LISTENING ANYMORE!');
};

function getWeatherData(city){
	return $.get('http://api.openweathermap.org/data/2.5/weather?q='+city+'&units=metric')
	.then(function(data){
		if(data.weather[0].main.toLowerCase().indexOf("rain") > -1)
			return "rain";
		else if(data.weather[0].main.toLowerCase().indexOf("rain") > -1)
			return "rain";
		else if(data.weather[0].main.toLowerCase().indexOf("clear") > -1)
			return "sun";
		else 
			return "clouds";
	});
}


$(document).ready(function(){
	recognition.start();
});
	


</script>

<body>
	<h1>hello world</h1>
	<textarea id="recognition"></textarea>
	<div id="city"></div>
	<div id="weather"></div>
</html>

